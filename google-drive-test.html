<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Google Drive Connectivity Test</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 800px;
            margin: 40px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .status {
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
            font-weight: bold;
        }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .warning { background: #fff3cd; color: #856404; }
        .info { background: #d1ecf1; color: #0c5460; }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover { background: #0056b3; }
        .test-result {
            margin: 10px 0;
            padding: 10px;
            border-left: 4px solid #007bff;
            background: #f8f9fa;
        }
        pre {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>üîç Google Drive Connectivity Test</h1>
        <p>This tool will help you test your Google Drive integration setup.</p>
        
        <div id="configStatus" class="status info">
            <strong>Configuration Status:</strong> Checking...
        </div>
        
        <div class="test-result">
            <h3>Current Configuration:</h3>
            <pre id="configDetails">Loading...</pre>
        </div>
        
        <button onclick="testGoogleAPIs()">Test Google APIs Loading</button>
        <button onclick="testAuthentication()">Test Authentication</button>
        <button onclick="testFolderAccess()">Test Folder Access</button>
        
        <div id="testResults"></div>
        
        <div class="test-result">
            <h3>üìã Setup Checklist:</h3>
            <div id="checklist">
                <div id="check1">‚è≥ Google Client ID configured</div>
                <div id="check2">‚è≥ Google API Key configured</div>
                <div id="check3">‚è≥ Google APIs loading</div>
                <div id="check4">‚è≥ Domain authorized</div>
                <div id="check5">‚è≥ Authentication working</div>
            </div>
        </div>
        
        <div class="status warning">
            <strong>‚ö†Ô∏è Important:</strong> Make sure you have your Google API Key ready to add to the main application!
        </div>
    </div>

    <!-- Google APIs -->
    <script src="https://apis.google.com/js/api.js"></script>
    <script src="https://accounts.google.com/gsi/client"></script>

    <script>
        // Configuration from your main application
        const GOOGLE_CLIENT_ID = '465131191592-kkd73c4d57upufd13njhoue4f4p1ggo2.apps.googleusercontent.com';
        const GOOGLE_API_KEY = 'AIzaSyCL9IVXR7NdT3Iif7Do5YTgVD-l_GCpzYk'; // Your API Key
        const TARGET_FOLDER_ID = '1k_LobI2ggS0rs83VevymeA0D-RHOTYSD';
        const DISCOVERY_DOC = 'https://www.googleapis.com/discovery/v1/apis/drive/v3/rest';
        const SCOPES = 'https://www.googleapis.com/auth/drive.file';

        let gapi_loaded = false;
        let gis_loaded = false;
        let tokenClient;
        let access_token = null;

        // Initialize on page load
        window.onload = function() {
            checkConfiguration();
            setTimeout(initializeAPIs, 1000);
        };

        function checkConfiguration() {
            const configDiv = document.getElementById('configStatus');
            const detailsDiv = document.getElementById('configDetails');
            
            let status = 'success';
            let message = 'Configuration looks good!';
            
            if (!GOOGLE_CLIENT_ID) {
                status = 'error';
                message = 'Google Client ID is missing!';
            } else if (!GOOGLE_API_KEY) {
                status = 'warning';
                message = 'Google API Key is missing - this is the main issue!';
            }
            
            configDiv.className = `status ${status}`;
            configDiv.innerHTML = `<strong>Configuration Status:</strong> ${message}`;
            
            detailsDiv.textContent = `
Client ID: ${GOOGLE_CLIENT_ID || 'NOT SET'}
API Key: ${GOOGLE_API_KEY || 'NOT SET'}
Target Folder: ${TARGET_FOLDER_ID}
Current Domain: ${window.location.origin}
            `.trim();
            
            updateChecklist('check1', GOOGLE_CLIENT_ID ? '‚úÖ' : '‚ùå', 'Google Client ID configured');
            updateChecklist('check2', GOOGLE_API_KEY ? '‚úÖ' : '‚ùå', 'Google API Key configured');
        }

        function updateChecklist(id, icon, text) {
            document.getElementById(id).innerHTML = `${icon} ${text}`;
        }

        function addTestResult(title, status, details) {
            const resultsDiv = document.getElementById('testResults');
            const statusClass = status === 'success' ? 'success' : status === 'error' ? 'error' : 'warning';
            
            resultsDiv.innerHTML += `
                <div class="status ${statusClass}">
                    <strong>${title}:</strong> ${details}
                </div>
            `;
        }

        function initializeAPIs() {
            try {
                if (typeof gapi !== 'undefined') {
                    gapi.load('client', initializeGapiClient);
                    updateChecklist('check3', '‚úÖ', 'Google APIs loading');
                } else {
                    updateChecklist('check3', '‚ùå', 'Google APIs failed to load');
                }
                
                if (typeof google !== 'undefined' && GOOGLE_CLIENT_ID) {
                    initializeGisClient();
                }
            } catch (error) {
                addTestResult('API Initialization', 'error', error.message);
            }
        }

        async function initializeGapiClient() {
            if (!GOOGLE_API_KEY) {
                addTestResult('GAPI Client', 'error', 'Cannot initialize without API Key');
                return;
            }
            
            try {
                await gapi.client.init({
                    apiKey: GOOGLE_API_KEY,
                    discoveryDocs: [DISCOVERY_DOC],
                });
                gapi_loaded = true;
                addTestResult('GAPI Client', 'success', 'Google API client initialized successfully');
            } catch (error) {
                addTestResult('GAPI Client', 'error', `Failed to initialize: ${error.message}`);
            }
        }

        function initializeGisClient() {
            try {
                tokenClient = google.accounts.oauth2.initTokenClient({
                    client_id: GOOGLE_CLIENT_ID,
                    scope: SCOPES,
                    callback: (tokenResponse) => {
                        if (tokenResponse.error) {
                            addTestResult('Authentication', 'error', tokenResponse.error);
                            updateChecklist('check5', '‚ùå', 'Authentication working');
                            return;
                        }
                        access_token = tokenResponse.access_token;
                        addTestResult('Authentication', 'success', 'Successfully authenticated with Google Drive');
                        updateChecklist('check5', '‚úÖ', 'Authentication working');
                    },
                });
                gis_loaded = true;
                addTestResult('GIS Client', 'success', 'Google Identity Services initialized');
                updateChecklist('check4', '‚úÖ', 'Domain authorized (client loaded)');
            } catch (error) {
                addTestResult('GIS Client', 'error', `Failed to initialize: ${error.message}`);
                updateChecklist('check4', '‚ùå', 'Domain authorization failed');
            }
        }

        function testGoogleAPIs() {
            addTestResult('API Loading Test', 'info', 'Testing Google APIs...');
            
            const tests = [
                { name: 'GAPI Available', result: typeof gapi !== 'undefined' },
                { name: 'Google Identity Available', result: typeof google !== 'undefined' },
                { name: 'GAPI Client Loaded', result: gapi_loaded },
                { name: 'GIS Client Loaded', result: gis_loaded },
                { name: 'Client ID Set', result: !!GOOGLE_CLIENT_ID },
                { name: 'API Key Set', result: !!GOOGLE_API_KEY }
            ];
            
            tests.forEach(test => {
                const status = test.result ? 'success' : 'error';
                const icon = test.result ? '‚úÖ' : '‚ùå';
                addTestResult(test.name, status, `${icon} ${test.result ? 'OK' : 'FAILED'}`);
            });
        }

        function testAuthentication() {
            if (!gis_loaded) {
                addTestResult('Authentication Test', 'error', 'Google Identity Services not loaded');
                return;
            }
            
            if (!GOOGLE_API_KEY) {
                addTestResult('Authentication Test', 'error', 'Cannot test without API Key');
                return;
            }
            
            addTestResult('Authentication Test', 'info', 'Starting authentication flow...');
            
            try {
                tokenClient.requestAccessToken({ prompt: 'consent' });
            } catch (error) {
                addTestResult('Authentication Test', 'error', `Authentication failed: ${error.message}`);
            }
        }

        async function testFolderAccess() {
            if (!access_token) {
                addTestResult('Folder Access Test', 'error', 'Please authenticate first');
                return;
            }
            
            addTestResult('Folder Access Test', 'info', 'Testing folder access...');
            
            try {
                const response = await fetch(`https://www.googleapis.com/drive/v3/files/${TARGET_FOLDER_ID}`, {
                    headers: {
                        'Authorization': `Bearer ${access_token}`
                    }
                });
                
                if (response.ok) {
                    const folderInfo = await response.json();
                    addTestResult('Folder Access Test', 'success', `‚úÖ Folder accessible: "${folderInfo.name}"`);
                } else {
                    addTestResult('Folder Access Test', 'error', `‚ùå Folder access failed: ${response.status} ${response.statusText}`);
                }
            } catch (error) {
                addTestResult('Folder Access Test', 'error', `‚ùå Error accessing folder: ${error.message}`);
            }
        }
    </script>
</body>
</html>